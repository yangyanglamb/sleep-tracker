## 项目概览

你的睡眠与饮食记录系统已经成功构建和部署！

### 🎯 系统特性

#### 1. 睡眠记录模块
- **双按钮控制**: 睡觉/起床按钮
- **实时状态显示**: 显示当前是否睡眠及睡眠时长
- **智能时长计算**:
  - 少于1小时: 精确到分钟（如"共睡了45分钟"）
  - 1小时以上: 显示小时和分钟（如"共睡了7时30分"）
  - 整数小时: 仅显示小时（如"共睡了8时"）

#### 2. 饮食记录模块
- **多种类型支持**: 早餐、午餐、晚餐、加餐、饮水、其他
- **快速选择**: 点击类型按钮快速选择
- **时间戳记录**: 自动记录饮食时间

#### 3. 错误处理
✅ **多次点击睡觉按钮**
- 只更新开始时间，不创建重复记录
- 解决了"先点击睡觉而没有先点击起床"的问题

✅ **多次点击起床按钮**
- 每次点击都会完成一条记录
- 正确处理"多次点击起床"的情况

✅ **无规律点击**
- 无睡眠记录下点击起床会创建记录
- 所有操作都有正确的业务逻辑处理

#### 4. 数据存储
- 使用 SQLite 数据库
- 数据永久保存在 `/root/sleep-tracker/tracker.db`
- 服务器重启后数据不会丢失

### 📂 项目结构

```
/root/sleep-tracker/
├── server.js              # Node.js 后端（Express 框架）
├── package.json           # NPM 依赖配置
├── package-lock.json      # 依赖锁定文件
├── tracker.db             # SQLite 数据库
├── README.md              # 详细技术文档
├── QUICKSTART.md          # 快速开始指南
├── start.sh               # 启动脚本
└── public/
    └── index.html         # 前端网页（响应式）
```

### 🚀 启动方式

#### 方式一（推荐）
```bash
/root/sleep-tracker/start.sh
```

#### 方式二
```bash
cd /root/sleep-tracker && npm start
```

#### 方式三（后台运行）
```bash
cd /root/sleep-tracker && nohup npm start > server.log 2>&1 &
```

### 🌐 访问地址

**网页界面**: http://localhost:5002

### 🔌 API 端点

| 操作 | 方法 | 端点 | 说明 |
|------|------|------|------|
| 开始睡眠 | POST | `/api/sleep-start` | 记录睡眠开始时间 |
| 结束睡眠 | POST | `/api/sleep-end` | 记录睡眠结束时间 |
| 睡眠状态 | GET | `/api/sleep-status` | 获取当前睡眠状态 |
| 睡眠记录 | GET | `/api/sleep-records` | 获取所有睡眠记录 |
| 记录吃饭 | POST | `/api/meal-record` | 记录吃饭时间 |
| 饮食记录 | GET | `/api/meal-records` | 获取所有饮食记录 |

### 📊 技术栈

| 层级 | 技术 | 说明 |
|------|------|------|
| 后端 | Node.js + Express | 轻量级 Web 服务器 |
| 数据库 | SQLite3 | 本地数据库，无需额外配置 |
| 前端 | HTML5 + CSS3 + JS | 原生开发，无第三方依赖 |
| 样式 | 响应式设计 | 支持各种屏幕尺寸 |

### ✨ 前端特性

- 🎨 现代化 UI 设计（渐变色、阴影、动画）
- 📱 完全响应式（手机、平板、桌面）
- ⚡ 实时更新（每30秒自动刷新）
- 🎯 标签页切换（分离睡眠和饮食记录）
- 💫 平滑动画（记录显示时的滑入效果）

### 💾 数据库设计

**sleep_records 表**
```sql
id          INTEGER   - 主键
sleep_start TEXT      - 睡眠开始时间
sleep_end   TEXT      - 睡眠结束时间（NULL 表示睡眠中）
created_at  DATETIME  - 创建时间
updated_at  DATETIME  - 更新时间
```

**meal_records 表**
```sql
id         INTEGER   - 主键
meal_time  TEXT      - 饮食时间
meal_type  TEXT      - 饮食类型
created_at DATETIME  - 创建时间
```

### 🧪 测试验证结果

已通过以下场景测试：
- ✅ 正常睡眠流程（睡觉→起床）
- ✅ 多次点击睡觉按钮（仅更新时间）
- ✅ 无睡眠记录下点击起床（创建记录）
- ✅ 睡眠时长计算（时/分/分钟）
- ✅ 饮食记录功能（6种类型）
- ✅ 数据持久化（重启后数据保留）
- ✅ API 接口响应
- ✅ 前端页面显示

### 📝 使用示例

#### 记录睡眠
1. 打开 http://localhost:5002
2. 点击"😴 睡觉"按钮
3. 页面显示"正在睡眠"状态
4. 睡眠后点击"🌅 起床"按钮
5. 睡眠记录自动显示在下方

#### 记录饮食
1. 在"饮食管理"部分选择饮食类型
2. 点击"🍽️ 记录吃饭"按钮
3. 切换到"饮食记录"标签页查看

### 🎓 代码亮点

1. **智能状态管理**: 使用数据库查询实时获取状态
2. **错误容错设计**: 处理各种不规则操作场景
3. **时间格式化**: 灵活的时长显示格式
4. **响应式前端**: 一套代码支持所有设备
5. **轻量级架构**: 无复杂框架依赖，易于维护

### 🔧 自定义修改

#### 修改颜色主题
编辑 `public/index.html` 中的 CSS 变量：
```css
background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
```

#### 修改时间格式
编辑 `server.js` 中的 `formatDateTime` 函数

#### 修改服务器端口
编辑 `server.js` 第 8 行：
```javascript
const PORT = 5002;  // 改为其他端口
```

### 📞 获取帮助

- 🔍 查看 `README.md` 获取详细技术文档
- 🚀 查看 `QUICKSTART.md` 获取快速开始指南
- 💻 查看 `server.js` 获取后端实现细节
- 🎨 查看 `public/index.html` 获取前端实现细节

---

**系统已完全就绪，现在可以开始使用了！** 🎉
