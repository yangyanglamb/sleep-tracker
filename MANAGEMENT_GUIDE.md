# 管理功能 - 用户指南

## 功能概览

成功为睡眠与饮食记录系统添加了完整的管理页面，包括：
- 📊 **查看统计** - 按日期范围查询和统计记录
- ➕ **添加记录** - 手动补录历史记录
- 🗑️ **删除记录** - 删除错误或不需要的记录

## 快速开始

### 访问管理页面
1. 打开主页：http://localhost:5002
2. 点击"📋 管理记录"按钮
3. 或直接访问：http://localhost:5002/manage.html

## 功能详解

### 📊 查看统计

**目的**: 查看历史记录和统计分析

**操作步骤**:
1. 选择开始日期和结束日期
2. 选择要查看的记录类型（所有/睡眠/饮食）
3. 点击"查询"按钮
4. 查看统计卡片和详细记录列表

**显示内容**:
- 睡眠记录数量和平均时长
- 饮食记录数量和各类型统计
- 指定日期范围内的所有记录

### ➕ 添加记录

**目的**: 手动补录历史记录或添加更早时间的记录

**添加睡眠记录**:
1. 切换到"添加记录"标签页
2. 选择睡眠的日期、开始时间、结束时间
3. 点击"添加睡眠记录"按钮
4. 系统自动计算睡眠时长并保存

**添加饮食记录**:
1. 选择日期和时间
2. 选择饮食类型（早餐/午餐/晚餐/加餐/饮水/其他）
3. 点击"添加饮食记录"按钮
4. 记录立即保存到数据库

### 🗑️ 删除记录

**目的**: 删除错误或不需要的记录

**操作步骤**:
1. 切换到"删除记录"标签页
2. 选择要删除的记录类型（睡眠/饮食）
3. 点击"加载记录"加载列表
4. 勾选要删除的记录（支持多选）
5. 点击"删除选中"进行删除
6. 系统会弹出确认对话框，确认后执行删除

**快捷操作**:
- "全选"按钮：一次选中所有记录
- 单条删除：勾选后直接删除

## 数据说明

### 主页显示顺序

主页上的记录按**时间倒序排列**（最新在前），这是因为：
- 便于查看最近的记录
- 新添加的记录会自动出现在顶部
- 历史记录排在下方

### 时间格式

所有记录统一采用以下格式显示：
- **睡眠**: `10月28日08时-10月28日16时 共睡了8小时`
- **饮食**: `10月28日12时 (午餐)`

数据库内部使用 ISO 8601 格式存储，确保精确的时间记录。

## API 接口

管理功能调用的后端接口：

| 接口 | 方法 | 说明 |
|------|------|------|
| `/api/sleep-records/custom` | POST | 手动添加睡眠记录 |
| `/api/meal-records/custom` | POST | 手动添加饮食记录 |
| `/api/sleep-records/:id` | DELETE | 删除睡眠记录 |
| `/api/meal-records/:id` | DELETE | 删除饮食记录 |
| `/api/records/filter` | GET | 按日期范围筛选 |
| `/api/statistics` | GET | 获取统计数据 |

## 常见问题

### Q: 为什么删除后数据还在主页显示？
A: 网页缓存导致。刷新页面即可看到最新数据。

### Q: 可以添加很久之前的记录吗？
A: 可以。只需在添加记录时选择过去的日期即可。

### Q: 批量删除会删除所有记录吗？
A: 不会。只有被勾选的记录会被删除。点击"全选"会选中当前加载的所有记录。

### Q: 删除操作可以撤销吗？
A: 不可以。请谨慎操作，确认无误后再删除。

## 场景示例

### 场景1：补录昨天的睡眠记录
1. 打开管理页面
2. 切换到"添加记录"标签页
3. 选择昨天的日期
4. 输入当时的开始时间（如22:00）和结束时间（如06:00）
5. 点击"添加睡眠记录"

### 场景2：查看本月的睡眠统计
1. 打开管理页面
2. 保留在"查看统计"标签页
3. 选择本月第一天和最后一天
4. 选择"睡眠记录"
5. 点击"查询"查看统计和详细列表

### 场景3：删除一个月前的错误记录
1. 打开管理页面
2. 切换到"删除记录"标签页
3. 选择"睡眠记录"
4. 点击"加载记录"
5. 找到需要删除的记录并勾选
6. 点击"删除选中"并确认

## 系统特性

✅ **自动时长计算** - 添加睡眠时自动计算时长
✅ **日期范围筛选** - 灵活的时间范围查询
✅ **统计汇总** - 自动统计各项数据
✅ **响应式设计** - 支持手机、平板、电脑
✅ **实时更新** - 修改后立即生效
✅ **数据持久化** - 所有数据保存在本地数据库

## 注意事项

⚠️ 删除操作**不可恢复**，请谨慎操作
⚠️ 数据库文件 `tracker.db` 包含所有历史数据，请定期备份
⚠️ 时间统计基于 ISO 8601 格式（UTC+时区），跨时区时请注意
⚠️ 大量数据查询时可能需要等待，请耐心等待

## 获取帮助

- 查看主文档：`README.md`
- 查看快速开始：`QUICKSTART.md`
- 查看项目概览：`PROJECT_OVERVIEW.md`
- 查看格式说明：`TIME_FORMAT_UPDATE.md`
